// // This file is speciifcally for extracting data from customers input and storing to db and later used for order placement delivery.

if (document.readyState == 'loading') {
    document.addEventListener('DOMContentLoaded', begin)
} else {
    begin()
}

function begin() {
    // Customer is already logged in and went to address page
    // then fetch their data and auto fill the form
    document.getElementsByClassName('registerbtn')[0].addEventListener('click', deliveryAddress);
}

function deliveryAddress() { //store user data to Firebase for extraction in the future
    // first validate customer email

    // if the email entered is already existing in database then request user to login with this

    // If the email does not exist then create a new branch under customer for firebase database
    extractAndStore();

   // var xemail = document.getElementById('email').value;
    // var xpassword = "Killerson1"

    // firebase.auth().createUserWithEmailAndPassword(xemail, xpassword)
    //     .then(u => { })
    //     .catch(error => {
    //         switch (error.code) {
    //             case 'auth/email-already-in-use':
    //                 console.log(`Email address ${xemail} already in use.`);
    //                 break;
    //             case 'auth/invalid-email':
    //                 console.log(`Email address ${xemail} is invalid.`);
    //                 break;
    //             default:
    //                 console.log(error.message);
    //                 break;
    //         }

    //         if('auth/invalid-email'){
    //             console.log("Email exists")
    //         } else {
    //             console.log("Email to be created");
    //         }
    //     });
}

// This function checks if customer account exists or not
// function validateAccount() {
//     console.log("do something");
//     customerEmailExists();
// }

// // checks if whether the input data i.e. email exists
// function customerEmailExists() {
//     var xemail = document.getElementById('email').value;

//     // take xemail and traverse firebase database for a match

// }

// this function stores customer input data to Firebase database
function extractAndStore() {
    // Extract all necessary data of customer
    var xname = document.getElementById('name');
    var xsurname = document.getElementById('surname');
    // concate name and surname into full name with a space between
    var xfullName = xname.value + " " + xsurname.value;

    var xaddressline1 = document.getElementById('address1').value;
    var xtown = document.getElementById('town').value;
    var xpostcode = document.getElementById('postcode').value;
    var xphone = document.getElementById('phone').value;
    var xemail = document.getElementById('email').value;


    // Generate a reference to a new location and add some data using push()
    var rootRef = firebase.database().ref("Customers");
    rootRef.push({
        name: xfullName,
        address: xaddressline1,
        town: xtown,
        postCode: xpostcode,
        phone: xphone,
        email: xemail,
        customerkey: rootRef.getKey()
    });
    // Get the unique ID generated by push() by accessing its key
    var postID = rootRef.getKey();
    console.log(postID);
}
